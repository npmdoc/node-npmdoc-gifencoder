<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/eugeneware/gifencoder">gifencoder (v1.0.6)</a>
</h1>
<h4>Streaming server-side animated (and non-animated) gif generation for node.js</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.gifencoder">module gifencoder</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.gifencoder">
            function <span class="apidocSignatureSpan"></span>gifencoder
            <span class="apidocSignatureSpan">(width, height)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder">
            function <span class="apidocSignatureSpan">gifencoder.</span>GIFEncoder
            <span class="apidocSignatureSpan">(width, height)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">gifencoder.</span>GIFEncoder.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.gifencoder.GIFEncoder">module gifencoder.GIFEncoder</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.GIFEncoder">
            function <span class="apidocSignatureSpan">gifencoder.</span>GIFEncoder
            <span class="apidocSignatureSpan">(width, height)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.gifencoder.GIFEncoder.prototype">module gifencoder.GIFEncoder.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.addFrame">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>addFrame
            <span class="apidocSignatureSpan">(imageData)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.analyzePixels">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>analyzePixels
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.createReadStream">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>createReadStream
            <span class="apidocSignatureSpan">(rs)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.createWriteStream">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>createWriteStream
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.emit">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>emit
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.end">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.findClosest">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>findClosest
            <span class="apidocSignatureSpan">(c)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.finish">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>finish
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.getImagePixels">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>getImagePixels
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.setDelay">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setDelay
            <span class="apidocSignatureSpan">(milliseconds)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.setDispose">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setDispose
            <span class="apidocSignatureSpan">(disposalCode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.setFrameRate">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setFrameRate
            <span class="apidocSignatureSpan">(fps)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.setQuality">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setQuality
            <span class="apidocSignatureSpan">(quality)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.setRepeat">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setRepeat
            <span class="apidocSignatureSpan">(repeat)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.setTransparent">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setTransparent
            <span class="apidocSignatureSpan">(color)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.start">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeGraphicCtrlExt">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeGraphicCtrlExt
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeImageDesc">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeImageDesc
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeLSD">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeLSD
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeNetscapeExt">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeNetscapeExt
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.writePalette">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writePalette
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.writePixels">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writePixels
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeShort">
            function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeShort
            <span class="apidocSignatureSpan">(pValue)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.gifencoder" id="apidoc.module.gifencoder">module gifencoder</a></h1>


    <h2>
        <a href="#apidoc.element.gifencoder.gifencoder" id="apidoc.element.gifencoder.gifencoder">
        function <span class="apidocSignatureSpan"></span>gifencoder
        <span class="apidocSignatureSpan">(width, height)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function GIFEncoder(width, height) {
  // image size
  this.width = ~~width;
  this.height = ~~height;

  // transparent color if given
  this.transparent = null;

  // transparent index in color table
  this.transIndex = 0;

  // -1 = no repeat, 0 = forever. anything else is repeat count
  this.repeat = -1;

  // frame delay (hundredths)
  this.delay = 0;

  this.image = null; // current frame
  this.pixels = null; // BGR byte array from frame
  this.indexedPixels = null; // converted frame indexed to palette
  this.colorDepth = null; // number of bit planes
  this.colorTab = null; // RGB palette
  this.usedEntry = new Array(); // active palette entries
  this.palSize = 7; // color table size (bits-1)
  this.dispose = -1; // disposal code (-1 = use default)
  this.firstFrame = true;
  this.sample = 10; // default sample interval for quantizer

  this.started = false; // started encoding

  this.readStreams = [];

  this.out = new ByteArray();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder" id="apidoc.element.gifencoder.GIFEncoder">
        function <span class="apidocSignatureSpan">gifencoder.</span>GIFEncoder
        <span class="apidocSignatureSpan">(width, height)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function GIFEncoder(width, height) {
  // image size
  this.width = ~~width;
  this.height = ~~height;

  // transparent color if given
  this.transparent = null;

  // transparent index in color table
  this.transIndex = 0;

  // -1 = no repeat, 0 = forever. anything else is repeat count
  this.repeat = -1;

  // frame delay (hundredths)
  this.delay = 0;

  this.image = null; // current frame
  this.pixels = null; // BGR byte array from frame
  this.indexedPixels = null; // converted frame indexed to palette
  this.colorDepth = null; // number of bit planes
  this.colorTab = null; // RGB palette
  this.usedEntry = new Array(); // active palette entries
  this.palSize = 7; // color table size (bits-1)
  this.dispose = -1; // disposal code (-1 = use default)
  this.firstFrame = true;
  this.sample = 10; // default sample interval for quantizer

  this.started = false; // started encoding

  this.readStreams = [];

  this.out = new ByteArray();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.gifencoder.GIFEncoder" id="apidoc.module.gifencoder.GIFEncoder">module gifencoder.GIFEncoder</a></h1>


    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.GIFEncoder" id="apidoc.element.gifencoder.GIFEncoder.GIFEncoder">
        function <span class="apidocSignatureSpan">gifencoder.</span>GIFEncoder
        <span class="apidocSignatureSpan">(width, height)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function GIFEncoder(width, height) {
  // image size
  this.width = ~~width;
  this.height = ~~height;

  // transparent color if given
  this.transparent = null;

  // transparent index in color table
  this.transIndex = 0;

  // -1 = no repeat, 0 = forever. anything else is repeat count
  this.repeat = -1;

  // frame delay (hundredths)
  this.delay = 0;

  this.image = null; // current frame
  this.pixels = null; // BGR byte array from frame
  this.indexedPixels = null; // converted frame indexed to palette
  this.colorDepth = null; // number of bit planes
  this.colorTab = null; // RGB palette
  this.usedEntry = new Array(); // active palette entries
  this.palSize = 7; // color table size (bits-1)
  this.dispose = -1; // disposal code (-1 = use default)
  this.firstFrame = true;
  this.sample = 10; // default sample interval for quantizer

  this.started = false; // started encoding

  this.readStreams = [];

  this.out = new ByteArray();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.gifencoder.GIFEncoder.prototype" id="apidoc.module.gifencoder.GIFEncoder.prototype">module gifencoder.GIFEncoder.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.addFrame" id="apidoc.element.gifencoder.GIFEncoder.prototype.addFrame">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>addFrame
        <span class="apidocSignatureSpan">(imageData)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addFrame = function (imageData) {
  // HTML Canvas 2D Context Passed In
  if (imageData &amp;&amp; imageData.getImageData) {
    this.image = imageData.getImageData(0, 0, this.width, this.height).data;
  } else {
    this.image = imageData;
  }

  this.getImagePixels(); // convert to correct format if necessary
  this.analyzePixels(); // build color table &amp; map pixels

  if (this.firstFrame) {
    this.writeLSD(); // logical screen descriptior
    this.writePalette(); // global color table
    if (this.repeat &gt;= 0) {
      // use NS app extension to indicate reps
      this.writeNetscapeExt();
    }
  }

  this.writeGraphicCtrlExt(); // write graphic control extension
  this.writeImageDesc(); // image descriptor
  if (!this.firstFrame) this.writePalette(); // local color table
  this.writePixels(); // encode and write pixel data

  this.firstFrame = false;
  this.emit();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// use node-canvas
var canvas = new Canvas(320, 240);
var ctx = canvas.getContext('2d');

// red rectangle
ctx.fillStyle = '#ff0000';
ctx.fillRect(0, 0, 320, 240);
encoder.<span class="apidocCodeKeywordSpan">addFrame</span>(ctx);

// green rectangle
ctx.fillStyle = '#00ff00';
ctx.fillRect(0, 0, 320, 240);
encoder.addFrame(ctx);

// blue rectangle
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.analyzePixels" id="apidoc.element.gifencoder.GIFEncoder.prototype.analyzePixels">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>analyzePixels
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">analyzePixels = function () {
  var len = this.pixels.length;
  var nPix = len / 3;

  this.indexedPixels = new Uint8Array(nPix);

  var imgq = new NeuQuant(this.pixels, this.sample);
  imgq.buildColormap(); // create reduced palette
  this.colorTab = imgq.getColormap();

  // map image pixels to new palette
  var k = 0;
  for (var j = 0; j &lt; nPix; j++) {
    var index = imgq.lookupRGB(
      this.pixels[k++] &amp; 0xff,
      this.pixels[k++] &amp; 0xff,
      this.pixels[k++] &amp; 0xff
    );
    this.usedEntry[index] = true;
    this.indexedPixels[j] = index;
  }

  this.pixels = null;
  this.colorDepth = 8;
  this.palSize = 7;

  // get closest match to transparent color if specified
  if (this.transparent !== null) {
    this.transIndex = this.findClosest(this.transparent);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (imageData &amp;&amp; imageData.getImageData) {
  this.image = imageData.getImageData(0, 0, this.width, this.height).data;
} else {
  this.image = imageData;
}

this.getImagePixels(); // convert to correct format if necessary
this.<span class="apidocCodeKeywordSpan">analyzePixels</span>(); // build color table &amp; map pixels

if (this.firstFrame) {
  this.writeLSD(); // logical screen descriptior
  this.writePalette(); // global color table
  if (this.repeat &gt;= 0) {
    // use NS app extension to indicate reps
    this.writeNetscapeExt();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.createReadStream" id="apidoc.element.gifencoder.GIFEncoder.prototype.createReadStream">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>createReadStream
        <span class="apidocSignatureSpan">(rs)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createReadStream = function (rs) {
  if (!rs) {
    rs = new stream.Readable();
    rs._read = function () {};
  }
  this.readStreams.push(rs);
  return rs;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
``` js
var GIFEncoder = require('gifencoder');
var Canvas = require('canvas');
var fs = require('fs');

var encoder = new GIFEncoder(320, 240);
// stream the results as they are available into myanimated.gif
encoder.<span class="apidocCodeKeywordSpan">createReadStream</span>().pipe(fs.createWriteStream('myanimated.gif'));

encoder.start();
encoder.setRepeat(0);   // 0 for repeat, -1 for no-repeat
encoder.setDelay(500);  // frame delay in ms
encoder.setQuality(10); // image quality. 10 is default.

// use node-canvas
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.createWriteStream" id="apidoc.element.gifencoder.GIFEncoder.prototype.createWriteStream">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>createWriteStream
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createWriteStream = function (options) {
  var self = this;
  if (options) {
    Object.keys(options).forEach(function (option) {
      var fn = 'set' + option[0].toUpperCase() + option.substr(1);
      if (~['setDelay', 'setFrameRate', 'setDispose', 'setRepeat',
           'setTransparent', 'setQuality'].indexOf(fn)) {
        self[fn].call(self, options[option]);
      }
    });
  }

  var ws = new stream.Duplex({ objectMode: true });
  ws._read = function () {};
  this.createReadStream(ws);

  var self = this;
  ws._write = function (data, enc, next) {
    if (!self.started) self.start();
    self.addFrame(data);
    next();
  };
  var end = ws.end;
  ws.end = function () {
    end.apply(ws, [].slice.call(arguments));
    self.finish();
  };
  return ws;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

``` js
var GIFEncoder = require('gifencoder');
var encoder = new GIFEncoder(854, 480);
var pngFileStream = require('png-file-stream');

pngFileStream('test/**/frame?.png')
  .pipe(encoder.<span class="apidocCodeKeywordSpan">createWriteStream</span>({ repeat: -1, delay: 500, quality: 10 }))
  .pipe(fs.createWriteStream('myanimated.gif')));
```

NB: The chunks that get emitted by your read stream must either by a 1-dimensional bitmap of RGBA
data (either an array or Buffer), or a canvas 2D `context`.

## Example: Streaming API - Reads
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.emit" id="apidoc.element.gifencoder.GIFEncoder.prototype.emit">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>emit
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emit = function () {
  var self = this;
  if (this.readStreams.length === 0) return;
  if (this.out.data.length) {
    this.readStreams.forEach(function (rs) {
      rs.push(new Buffer(self.out.data));
    });
    this.out.data = [];
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    });
    this.out.data = [];
  }
};

GIFEncoder.prototype.end = function() {
  if (this.readStreams.length === null) return;
  this.<span class="apidocCodeKeywordSpan">emit</span>();
  this.readStreams.forEach(function (rs) {
    rs.push(null);
  });
  this.readStreams = [];
};

/*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.end" id="apidoc.element.gifencoder.GIFEncoder.prototype.end">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">end = function () {
  if (this.readStreams.length === null) return;
  this.emit();
  this.readStreams.forEach(function (rs) {
    rs.push(null);
  });
  this.readStreams = [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/*
Adds final trailer to the GIF stream, if you don't call the finish method
the GIF stream will not be valid.
*/
GIFEncoder.prototype.finish = function() {
this.out.writeByte(0x3b); // gif trailer
this.<span class="apidocCodeKeywordSpan">end</span>();
};

/*
Sets quality of color quantization (conversion of images to the maximum 256
colors allowed by the GIF specification). Lower values (minimum = 1)
produce better colors, but slow processing significantly. 10 is the
default, and produces good color mapping at reasonable speeds. Values
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.findClosest" id="apidoc.element.gifencoder.GIFEncoder.prototype.findClosest">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>findClosest
        <span class="apidocSignatureSpan">(c)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">findClosest = function (c) {
  if (this.colorTab === null) return -1;

  var r = (c &amp; 0xFF0000) &gt;&gt; 16;
  var g = (c &amp; 0x00FF00) &gt;&gt; 8;
  var b = (c &amp; 0x0000FF);
  var minpos = 0;
  var dmin = 256 * 256 * 256;
  var len = this.colorTab.length;

  for (var i = 0; i &lt; len;) {
    var dr = r - (this.colorTab[i++] &amp; 0xff);
    var dg = g - (this.colorTab[i++] &amp; 0xff);
    var db = b - (this.colorTab[i] &amp; 0xff);
    var d = dr * dr + dg * dg + db * db;
    var index = i / 3;
    if (this.usedEntry[index] &amp;&amp; (d &lt; dmin)) {
      dmin = d;
      minpos = index;
    }
    i++;
  }

  return minpos;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  this.pixels = null;
  this.colorDepth = 8;
  this.palSize = 7;

  // get closest match to transparent color if specified
  if (this.transparent !== null) {
    this.transIndex = this.<span class="apidocCodeKeywordSpan">findClosest</span>(this.transparent);
  }
};

/*
  Returns index of palette color closest to c
*/
GIFEncoder.prototype.findClosest = function(c) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.finish" id="apidoc.element.gifencoder.GIFEncoder.prototype.finish">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>finish
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">finish = function () {
  this.out.writeByte(0x3b); // gif trailer
  this.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
encoder.addFrame(ctx);

// blue rectangle
ctx.fillStyle = '#0000ff';
ctx.fillRect(0, 0, 320, 240);
encoder.addFrame(ctx);

encoder.<span class="apidocCodeKeywordSpan">finish</span>();
```
The above code will generate the following animated GIF:

![Animated GIF](https://raw.github.com/eugeneware/gifencoder/master/examples/myanimated.gif)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.getImagePixels" id="apidoc.element.gifencoder.GIFEncoder.prototype.getImagePixels">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>getImagePixels
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getImagePixels = function () {
  var w = this.width;
  var h = this.height;
  this.pixels = new Uint8Array(w * h * 3);

  var data = this.image;
  var count = 0;

  for (var i = 0; i &lt; h; i++) {
    for (var j = 0; j &lt; w; j++) {
      var b = (i * w * 4) + j * 4;
      this.pixels[count++] = data[b];
      this.pixels[count++] = data[b+1];
      this.pixels[count++] = data[b+2];
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// HTML Canvas 2D Context Passed In
if (imageData &amp;&amp; imageData.getImageData) {
  this.image = imageData.getImageData(0, 0, this.width, this.height).data;
} else {
  this.image = imageData;
}

this.<span class="apidocCodeKeywordSpan">getImagePixels</span>(); // convert to correct format if necessary
this.analyzePixels(); // build color table &amp; map pixels

if (this.firstFrame) {
  this.writeLSD(); // logical screen descriptior
  this.writePalette(); // global color table
  if (this.repeat &gt;= 0) {
    // use NS app extension to indicate reps
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.setDelay" id="apidoc.element.gifencoder.GIFEncoder.prototype.setDelay">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setDelay
        <span class="apidocSignatureSpan">(milliseconds)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setDelay = function (milliseconds) {
  this.delay = Math.round(milliseconds / 10);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var encoder = new GIFEncoder(320, 240);
// stream the results as they are available into myanimated.gif
encoder.createReadStream().pipe(fs.createWriteStream('myanimated.gif'));

encoder.start();
encoder.setRepeat(0);   // 0 for repeat, -1 for no-repeat
encoder.<span class="apidocCodeKeywordSpan">setDelay</span>(500);  // frame delay in ms
encoder.setQuality(10); // image quality. 10 is default.

// use node-canvas
var canvas = new Canvas(320, 240);
var ctx = canvas.getContext('2d');

// red rectangle
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.setDispose" id="apidoc.element.gifencoder.GIFEncoder.prototype.setDispose">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setDispose
        <span class="apidocSignatureSpan">(disposalCode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setDispose = function (disposalCode) {
  if (disposalCode &gt;= 0) this.dispose = disposalCode;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.setFrameRate" id="apidoc.element.gifencoder.GIFEncoder.prototype.setFrameRate">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setFrameRate
        <span class="apidocSignatureSpan">(fps)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setFrameRate = function (fps) {
  this.delay = Math.round(100 / fps);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.setQuality" id="apidoc.element.gifencoder.GIFEncoder.prototype.setQuality">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setQuality
        <span class="apidocSignatureSpan">(quality)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setQuality = function (quality) {
  if (quality &lt; 1) quality = 1;
  this.sample = quality;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var encoder = new GIFEncoder(320, 240);
// stream the results as they are available into myanimated.gif
encoder.createReadStream().pipe(fs.createWriteStream('myanimated.gif'));

encoder.start();
encoder.setRepeat(0);   // 0 for repeat, -1 for no-repeat
encoder.setDelay(500);  // frame delay in ms
encoder.<span class="apidocCodeKeywordSpan">setQuality</span>(10); // image quality. 10 is default.

// use node-canvas
var canvas = new Canvas(320, 240);
var ctx = canvas.getContext('2d');

// red rectangle
ctx.fillStyle = '#ff0000';
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.setRepeat" id="apidoc.element.gifencoder.GIFEncoder.prototype.setRepeat">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setRepeat
        <span class="apidocSignatureSpan">(repeat)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setRepeat = function (repeat) {
  this.repeat = repeat;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var fs = require('fs');

var encoder = new GIFEncoder(320, 240);
// stream the results as they are available into myanimated.gif
encoder.createReadStream().pipe(fs.createWriteStream('myanimated.gif'));

encoder.start();
encoder.<span class="apidocCodeKeywordSpan">setRepeat</span>(0);   // 0 for repeat, -1 for no-repeat
encoder.setDelay(500);  // frame delay in ms
encoder.setQuality(10); // image quality. 10 is default.

// use node-canvas
var canvas = new Canvas(320, 240);
var ctx = canvas.getContext('2d');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.setTransparent" id="apidoc.element.gifencoder.GIFEncoder.prototype.setTransparent">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>setTransparent
        <span class="apidocSignatureSpan">(color)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setTransparent = function (color) {
  this.transparent = color;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.start" id="apidoc.element.gifencoder.GIFEncoder.prototype.start">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function () {
  this.out.writeUTFBytes("GIF89a");
  this.started = true;
  this.emit();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var Canvas = require('canvas');
var fs = require('fs');

var encoder = new GIFEncoder(320, 240);
// stream the results as they are available into myanimated.gif
encoder.createReadStream().pipe(fs.createWriteStream('myanimated.gif'));

encoder.<span class="apidocCodeKeywordSpan">start</span>();
encoder.setRepeat(0);   // 0 for repeat, -1 for no-repeat
encoder.setDelay(500);  // frame delay in ms
encoder.setQuality(10); // image quality. 10 is default.

// use node-canvas
var canvas = new Canvas(320, 240);
var ctx = canvas.getContext('2d');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeGraphicCtrlExt" id="apidoc.element.gifencoder.GIFEncoder.prototype.writeGraphicCtrlExt">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeGraphicCtrlExt
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeGraphicCtrlExt = function () {
  this.out.writeByte(0x21); // extension introducer
  this.out.writeByte(0xf9); // GCE label
  this.out.writeByte(4); // data block size

  var transp, disp;
  if (this.transparent === null) {
    transp = 0;
    disp = 0; // dispose = no action
  } else {
    transp = 1;
    disp = 2; // force clear if using transparent color
  }

  if (this.dispose &gt;= 0) {
    disp = this.dispose &amp; 7; // user override
  }
  disp &lt;&lt;= 2;

  // packed fields
  this.out.writeByte(
    0 | // 1:3 reserved
    disp | // 4:6 disposal
    0 | // 7 user input - 0 = none
    transp // 8 transparency flag
  );

  this.writeShort(this.delay); // delay x 1/100 sec
  this.out.writeByte(this.transIndex); // transparent color index
  this.out.writeByte(0); // block terminator
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    this.writePalette(); // global color table
    if (this.repeat &gt;= 0) {
      // use NS app extension to indicate reps
      this.writeNetscapeExt();
    }
  }

  this.<span class="apidocCodeKeywordSpan">writeGraphicCtrlExt</span>(); // write graphic control extension
  this.writeImageDesc(); // image descriptor
  if (!this.firstFrame) this.writePalette(); // local color table
  this.writePixels(); // encode and write pixel data

  this.firstFrame = false;
  this.emit();
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeImageDesc" id="apidoc.element.gifencoder.GIFEncoder.prototype.writeImageDesc">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeImageDesc
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeImageDesc = function () {
  this.out.writeByte(0x2c); // image separator
  this.writeShort(0); // image position x,y = 0,0
  this.writeShort(0);
  this.writeShort(this.width); // image size
  this.writeShort(this.height);

  // packed fields
  if (this.firstFrame) {
    // no LCT - GCT is used for first (or only) frame
    this.out.writeByte(0);
  } else {
    // specify normal LCT
    this.out.writeByte(
      0x80 | // 1 local color table 1=yes
      0 | // 2 interlace - 0=no
      0 | // 3 sorted - 0=no
      0 | // 4-5 reserved
      this.palSize // 6-8 size of color table
    );
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (this.repeat &gt;= 0) {
      // use NS app extension to indicate reps
      this.writeNetscapeExt();
    }
  }

  this.writeGraphicCtrlExt(); // write graphic control extension
  this.<span class="apidocCodeKeywordSpan">writeImageDesc</span>(); // image descriptor
  if (!this.firstFrame) this.writePalette(); // local color table
  this.writePixels(); // encode and write pixel data

  this.firstFrame = false;
  this.emit();
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeLSD" id="apidoc.element.gifencoder.GIFEncoder.prototype.writeLSD">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeLSD
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeLSD = function () {
  // logical screen size
  this.writeShort(this.width);
  this.writeShort(this.height);

  // packed fields
  this.out.writeByte(
    0x80 | // 1 : global color table flag = 1 (gct used)
    0x70 | // 2-4 : color resolution = 7
    0x00 | // 5 : gct sort flag = 0
    this.palSize // 6-8 : gct size
  );

  this.out.writeByte(0); // background color index
  this.out.writeByte(0); // pixel aspect ratio - assume 1:1
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.image = imageData;
}

this.getImagePixels(); // convert to correct format if necessary
this.analyzePixels(); // build color table &amp; map pixels

if (this.firstFrame) {
  this.<span class="apidocCodeKeywordSpan">writeLSD</span>(); // logical screen descriptior
  this.writePalette(); // global color table
  if (this.repeat &gt;= 0) {
    // use NS app extension to indicate reps
    this.writeNetscapeExt();
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeNetscapeExt" id="apidoc.element.gifencoder.GIFEncoder.prototype.writeNetscapeExt">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeNetscapeExt
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeNetscapeExt = function () {
  this.out.writeByte(0x21); // extension introducer
  this.out.writeByte(0xff); // app extension label
  this.out.writeByte(11); // block size
  this.out.writeUTFBytes('NETSCAPE2.0'); // app id + auth code
  this.out.writeByte(3); // sub-block size
  this.out.writeByte(1); // loop sub-block id
  this.writeShort(this.repeat); // loop count (extra iterations, 0=repeat forever)
  this.out.writeByte(0); // block terminator
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.analyzePixels(); // build color table &amp; map pixels

if (this.firstFrame) {
  this.writeLSD(); // logical screen descriptior
  this.writePalette(); // global color table
  if (this.repeat &gt;= 0) {
    // use NS app extension to indicate reps
    this.<span class="apidocCodeKeywordSpan">writeNetscapeExt</span>();
  }
}

this.writeGraphicCtrlExt(); // write graphic control extension
this.writeImageDesc(); // image descriptor
if (!this.firstFrame) this.writePalette(); // local color table
this.writePixels(); // encode and write pixel data
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.writePalette" id="apidoc.element.gifencoder.GIFEncoder.prototype.writePalette">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writePalette
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writePalette = function () {
  this.out.writeBytes(this.colorTab);
  var n = (3 * 256) - this.colorTab.length;
  for (var i = 0; i &lt; n; i++)
    this.out.writeByte(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

this.getImagePixels(); // convert to correct format if necessary
this.analyzePixels(); // build color table &amp; map pixels

if (this.firstFrame) {
  this.writeLSD(); // logical screen descriptior
  this.<span class="apidocCodeKeywordSpan">writePalette</span>(); // global color table
  if (this.repeat &gt;= 0) {
    // use NS app extension to indicate reps
    this.writeNetscapeExt();
  }
}

this.writeGraphicCtrlExt(); // write graphic control extension
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.writePixels" id="apidoc.element.gifencoder.GIFEncoder.prototype.writePixels">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writePixels
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writePixels = function () {
  var enc = new LZWEncoder(this.width, this.height, this.indexedPixels, this.colorDepth);
  enc.encode(this.out);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    this.writeNetscapeExt();
  }
}

this.writeGraphicCtrlExt(); // write graphic control extension
this.writeImageDesc(); // image descriptor
if (!this.firstFrame) this.writePalette(); // local color table
this.<span class="apidocCodeKeywordSpan">writePixels</span>(); // encode and write pixel data

this.firstFrame = false;
this.emit();
};

/*
Adds final trailer to the GIF stream, if you don't call the finish method
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.gifencoder.GIFEncoder.prototype.writeShort" id="apidoc.element.gifencoder.GIFEncoder.prototype.writeShort">
        function <span class="apidocSignatureSpan">gifencoder.GIFEncoder.prototype.</span>writeShort
        <span class="apidocSignatureSpan">(pValue)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">writeShort = function (pValue) {
  this.out.writeByte(pValue &amp; 0xFF);
  this.out.writeByte((pValue &gt;&gt; 8) &amp; 0xFF);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.out.writeByte(
    0 | // 1:3 reserved
    disp | // 4:6 disposal
    0 | // 7 user input - 0 = none
    transp // 8 transparency flag
  );

  this.<span class="apidocCodeKeywordSpan">writeShort</span>(this.delay); // delay x 1/100 sec
  this.out.writeByte(this.transIndex); // transparent color index
  this.out.writeByte(0); // block terminator
};

/*
  Writes Image Descriptor
*/
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>